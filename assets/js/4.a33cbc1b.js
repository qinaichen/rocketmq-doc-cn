(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{49:function(t,s,a){"use strict";a.r(s);var n=a(0),e=Object(n.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"content"},[a("h3",{attrs:{id:"消息过滤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#消息过滤","aria-hidden":"true"}},[t._v("#")]),t._v(" 消息过滤")]),a("p",[t._v("很多情况下，"),a("strong",[t._v("标签")]),t._v(" 只是用来简单的选择用户需要的消息，例如：")]),a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("\nDefaultMQPushConsumer consumer "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("DefaultMQPushConsumer")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v('"CID_EXAMPLE"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsumer"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("subscribe")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v('"TOPIC"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"TAGA || TAGB || TAGC"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n")])]),a("p",[t._v("这个消费者就会接收到"),a("code",[t._v("TAGA")]),t._v("、"),a("code",[t._v("TAGB")]),t._v("、"),a("code",[t._v("TAGC")]),t._v("中的信息，但是只能允许一个消息有一个标签，不能支持其他的复杂业务场景，\n因此，我们可以使用"),a("code",[t._v("SQL")]),t._v("表达式来过滤消息")]),a("h3",{attrs:{id:"原则"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#原则","aria-hidden":"true"}},[t._v("#")]),t._v(" 原则")]),a("p",[a("code",[t._v("SQL")]),t._v(" 的特点是可以通过一些消息中属性的计算。通过在"),a("code",[t._v("RocketMQ")]),t._v("中定义的语法，实现一些有意思的逻辑，例如：")]),a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("------------\n| message  |\n|----------|  a > 5 AND b = 'abc'\n| a = 10   |  --------------------\x3e Gotten\n| b = 'abc'|\n| c = true |\n------------\n\n\n------------\n| message  |\n|----------|   a > 5 AND b = 'abc'\n| a = 1    |  --------------------\x3e Missed\n| b = 'abc'|\n| c = true |\n------------\n")])]),a("h3",{attrs:{id:"语法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#语法","aria-hidden":"true"}},[t._v("#")]),t._v(" 语法")]),a("p",[a("code",[t._v("RocketMQ")]),t._v(" 只定义了一些简单的语法来支持这些特性，当然使用者也可以对其进行一些简单的扩展")]),a("ol",[a("li",[t._v("数字类型的比较,如 "),a("code",[t._v(">")]),t._v(","),a("code",[t._v(">=")]),t._v(","),a("code",[t._v("<")]),t._v(","),a("code",[t._v("<=")]),t._v(","),a("code",[t._v("BETWEEN")]),t._v(","),a("code",[t._v("=")])]),a("li",[t._v("字符类型的比较，如 "),a("code",[t._v("=")]),t._v(","),a("code",[t._v("<>")]),t._v(","),a("code",[t._v("IN")])]),a("li",[a("code",[t._v("IS NULL")]),t._v(" 或 "),a("code",[t._v("IS NOT NULL")])]),a("li",[t._v("逻辑运算 "),a("code",[t._v("AND")]),t._v(","),a("code",[t._v("OR")]),t._v(","),a("code",[t._v("NOT")])])]),a("h4",{attrs:{id:"常量类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常量类型","aria-hidden":"true"}},[t._v("#")]),t._v(" 常量类型")]),a("ol",[a("li",[t._v("数字 ，"),a("code",[t._v("123")]),t._v(","),a("code",[t._v("3.1415")])]),a("li",[t._v("字符 ，"),a("code",[t._v("'abc'")]),t._v(" 这里必须要使用单引号")]),a("li",[a("code",[t._v("NULL")]),t._v(" 特殊常量")]),a("li",[t._v("布尔类型 "),a("code",[t._v("TRUE")]),t._v(" 或者 "),a("code",[t._v("FALSE")])])]),a("h3",{attrs:{id:"使用限制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用限制","aria-hidden":"true"}},[t._v("#")]),t._v(" 使用限制")]),a("p",[t._v("只有消费者在订阅消息的时候使用"),a("code",[t._v("SQL92")])]),a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("subscribe")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token keyword"}},[t._v("final")]),t._v(" String topic"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("final")]),t._v(" MessageSelector messageSelector"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),a("h3",{attrs:{id:"生产者范例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#生产者范例","aria-hidden":"true"}},[t._v("#")]),t._v(" 生产者范例")]),a("p",[t._v("消息生产者可以在发送消息的时候通过"),a("code",[t._v("putUserProperty")]),t._v("放置一些属性")]),a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("\nDefaultMQProducer producer "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("DefaultMQProducer")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v('"please_rename_unique_group_name"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nproducer"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("start")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nMessage msg "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("Message")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v('"TopicTest"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    tag"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v('"Hello RocketMQ "')]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("+")]),t._v(" i"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("getBytes")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("RemotingHelper"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("DEFAULT_CHARSET"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("// 设置属性")]),t._v("\nmsg"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("putUserProperty")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v('"a"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" String"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("valueOf")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nSendResult sendResult "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" producer"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("send")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("msg"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nproducer"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("shutdown")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n")])]),a("h3",{attrs:{id:"消费者范例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#消费者范例","aria-hidden":"true"}},[t._v("#")]),t._v(" 消费者范例")]),a("p",[t._v("消费者在接收消息的时候可以使用"),a("code",[t._v("MessageSelector.bySql")]),t._v("来进行消息的过滤")]),a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[t._v("DefaultMQPushConsumer consumer "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("DefaultMQPushConsumer")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v('"please_rename_unique_group_name_4"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// 只有订阅的消息包含属性 a, 并且 a >=0 and a <= 3")]),t._v("\nconsumer"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("subscribe")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v('"TopicTest"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" MessageSelector"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("bySql")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v('"a between 0 and 3"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nconsumer"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("registerMessageListener")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("MessageListenerConcurrently")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" ConsumeConcurrentlyStatus "),a("span",{attrs:{class:"token function"}},[t._v("consumeMessage")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("List"),a("span",{attrs:{class:"token generics function"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("MessageExt"),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" msgs"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ConsumeConcurrentlyContext context"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" ConsumeConcurrentlyStatus"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("CONSUME_SUCCESS"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsumer"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("start")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n")])])])}],!1,null,null,null);s.default=e.exports}}]);